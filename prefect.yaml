# prefect.yaml - deployment configurations for FieldRoutes ETL flows
deployments:
  - name: fieldroutes-nightly
    flow_name: FieldRoutes_Nightly_Flow
    entrypoint: flows/fieldroutes_etl_flow.py:run_nightly_fieldroutes_etl
    # schedule:
    #   cron: "0 6 * * *"            # run daily at 6:00 AM Mountain Time
    #   timezone: "America/Denver"
    description: "Nightly full extract of all FieldRoutes entities for all offices."
    tags: ["fieldroutes", "nightly"]
    work_pool:
      name: default-work-pool
    parameters: {} 
    pull:
      - prefect.deployments.steps.git_clone:
          id: clone_repo
          repository: https://github.com/alta-evanunick/altapest-prefect.git
          branch: main
          credentials: "{{ prefect.blocks.github-credentials.github-evanunick }}"
      - prefect.deployments.steps.run_shell_script:
          id: install_requirements
          script: "pip install prefect prefect-snowflake snowflake-connector-python snowflake-sqlalchemy requests pandas pyarrow tenacity"
  - name: fieldroutes-cdc
    flow_name: FieldRoutes_CDC_Flow
    entrypoint: flows/deploy_flows.py:run_cdc_fieldroutes_etl
    # schedule:
    #   cron: "0 8-17/2 * * 1-5"     # run every 2 hours between 8:00-17:00, Monday-Friday
    #   timezone: "America/Denver"
    description: "2-hour interval CDC for high-velocity FieldRoutes tables during business hours."
    tags: ["fieldroutes", "cdc"]
    work_pool:
      name: default-work-pool
    parameters: {}
    pull:
      - prefect.deployments.steps.git_clone:
          repository: https://github.com/alta-evanunick/altapest-prefect.git
          branch: main
          credentials: "{{ prefect.blocks.github-credentials.github-evanunick }}"
      - prefect.deployments.steps.run_shell_script:
          id: install_requirements
          script: "pip install prefect prefect-snowflake snowflake-connector-python snowflake-sqlalchemy requests pandas pyarrow tenacity"
