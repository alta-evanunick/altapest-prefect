deployments:
  - name: fieldroutes-nightly
    flow_name: FieldRoutes_Nightly_ETL
    entrypoint: flows/deploy_flows.py:run_nightly_fieldroutes_etl
    schedule:
      cron: "0 6 * * *"            
      timezone: "America/Denver"
    description: "Nightly full extract of all FieldRoutes entities for all offices."
    tags: ["fieldroutes", "nightly", "full-extract"]
    work_pool:
      name: default-work-pool
    parameters: {} 
    pull:
      - prefect.deployments.steps.git_clone:
          id: clone_repo
          repository: https://github.com/alta-evanunick/altapest-prefect.git
          branch: main
          credentials: "{{ prefect.blocks.github-credentials.github-evanunick }}"
      - prefect.deployments.steps.run_shell_script:
          id: install_requirements
          script: |
            pip install prefect prefect-snowflake snowflake-connector-python snowflake-sqlalchemy requests pandas pyarrow<19.0.0 tenacity pytz prefect-azure azure-storage-blob
            python -c "from prefect_snowflake import SnowflakeConnector; import pytz; print('Snowflake connector and pytz available')"
  
  - name: fieldroutes-cdc
    flow_name: FieldRoutes_CDC_ETL
    entrypoint: flows/deploy_flows.py:run_cdc_fieldroutes_etl
    schedule:
      cron: "0 8-17/2 * * 1-5"
      timezone: "America/Denver"
    description: "2-hour interval CDC for high-velocity FieldRoutes tables during business hours."
    tags: ["fieldroutes", "cdc", "incremental"]
    work_pool:
      name: default-work-pool
    parameters: {}
    pull:
      - prefect.deployments.steps.git_clone:
          repository: https://github.com/alta-evanunick/altapest-prefect.git
          branch: main
          credentials: "{{ prefect.blocks.github-credentials.github-evanunick }}"
      - prefect.deployments.steps.run_shell_script:
          id: install_requirements
          script: |
            pip install prefect prefect-snowflake snowflake-connector-python snowflake-sqlalchemy requests pandas pyarrow<19.0.0 tenacity azure-storage-blob prefect-azure
            python -c "import prefect, prefect_snowflake, snowflake.connector, requests, pandas, pyarrow<19.0.0, tenacity, azure.storage.blob, prefect_azure; print('All dependencies loaded')"

  - name: fieldroutes-dev
    flow_name: FieldRoutes_Nightly_ETL
    entrypoint: flows/deploy_flows.py:run_nightly_fieldroutes_etl
    description: "Development deployment for testing - no schedule"
    tags: ["fieldroutes", "development", "test"]
    work_pool:
      name: default-work-pool
    parameters:
      test_mode: true
    pull:
      - prefect.deployments.steps.git_clone:
          repository: https://github.com/alta-evanunick/altapest-prefect.git
          branch: develop  
          credentials: "{{ prefect.blocks.github-credentials.github-evanunick }}"
      - prefect.deployments.steps.run_shell_script:
          script: |
            pip install prefect prefect-snowflake snowflake-connector-python snowflake-sqlalchemy requests pandas pyarrow<19.0.0 tenacity azure-storage-blob prefect-azure
            python -c "import prefect, prefect_snowflake, snowflake.connector, requests, pandas, pyarrow<19.0.0, tenacity, azure.storage.blob, prefect_azure; print('All dependencies loaded')"